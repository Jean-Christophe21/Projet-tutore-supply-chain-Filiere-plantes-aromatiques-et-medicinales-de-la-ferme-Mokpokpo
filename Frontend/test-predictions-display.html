<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Affichage des Pr�dictions</title>
    <link rel="stylesheet" href="css/css_bootstrap/bootstrap.min.css">
    <style>
        body { padding: 20px; background: #f8f9fa; }
        .test-section { margin-bottom: 40px; }
        .test-header { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">?? Test d'Affichage des Pr�dictions</h1>
        
        <!-- Test Predictions -->
        <div class="test-section">
            <div class="test-header">
                <h2 class="mb-0">?? Test 1: Pr�dictions de Ventes</h2>
            </div>
            <div id="testPredictions"></div>
        </div>
        
        <!-- Test Historical Data -->
        <div class="test-section">
            <div class="test-header">
                <h2 class="mb-0">?? Test 2: Donn�es Historiques</h2>
            </div>
            <div id="testHistorical"></div>
        </div>
        
        <!-- Test Empty Data -->
        <div class="test-section">
            <div class="test-header">
                <h2 class="mb-0">?? Test 3: Donn�es Vides</h2>
            </div>
            <div id="testEmpty"></div>
        </div>
    </div>
    
    <script>
        // Sample data for predictions
        const samplePredictions = {
            forecast_7_days: 763.63,
            trends: "Les donn�es indiquent une forte saisonnalit� des ventes concentr�e sur la p�riode des f�tes de fin d'ann�e (du 15 au 29 d�cembre), avec un pic de CA enregistr� le 29 d�cembre (355.0). Il est notable que les ventes chutent significativement et montrent une plus grande volatilit� apr�s le Nouvel An (d�but janvier). La tendance g�n�rale hors pic saisonnier est un CA journalier moyen autour de 109.09.",
            recommendations: [
                "Prioriser la production et le stockage du Miel et du Poulet, car ils repr�sentent clairement les produits phares de la ferme (32 et 28 unit�s vendues respectivement).",
                "Planifier des promotions ou des offres sp�ciales durant les p�riodes creuses (comme apr�s le Nouvel An) pour stabiliser le CA journalier et maintenir l'engagement client.",
                "D�buter la planification et l'augmentation des stocks pour la prochaine saison de forte demande (No�l/Nouvel An) d�s le trimestre pr�c�dent, en ciblant une disponibilit� maximale des produits les plus chers durant cette fen�tre.",
                "Mettre en place un suivi pr�cis de la date d'expiration pour le Poulet (produit frais) afin de minimiser le gaspillage, en particulier lorsque les ventes ralentissent."
            ],
            analysis_text: "L'analyse des ventes sur la p�riode observ�e (30 jours) r�v�le un Chiffre d'Affaires total de 1200.0, fortement influenc� par la saison des f�tes. Le pic de CA et la forte demande de Miel et de Poulet sont les �l�ments commerciaux dominants. Notre pr�vision conservatrice pour les 7 prochains jours est bas�e sur la moyenne des jours de vente observ�s (environ 109.09 par jour), refl�tant la stabilisation des ventes apr�s l'effervescence de la fin d'ann�e."
        };
        
        // Sample data for historical
        const sampleHistorical = [
            { date: "2025-12-10", ca: 15 },
            { date: "2025-12-12", ca: 15 },
            { date: "2025-12-15", ca: 125 },
            { date: "2025-12-22", ca: 25 },
            { date: "2025-12-23", ca: 200 },
            { date: "2025-12-26", ca: 75 },
            { date: "2025-12-28", ca: 175 },
            { date: "2025-12-29", ca: 355 },
            { date: "2025-12-30", ca: 15 },
            { date: "2026-01-07", ca: 45 },
            { date: "2026-01-08", ca: 175 }
        ];
        
        // Render Sales Predictions
        function renderSalesPredictions(data) {
            if (typeof data === 'string') {
                try { data = JSON.parse(data); } 
                catch (e) { return '<div class="alert alert-warning">Format de donn�es non reconnu</div>'; }
            }
            
            if (data && typeof data === 'object') {
                const forecast = data.forecast_7_days || 0;
                const trends = data.trends || 'Aucune tendance disponible';
                const recommendations = data.recommendations || [];
                const analysisText = data.analysis_text || 'Aucune analyse disponible';
                
                return `
                    <div class="alert alert-info mb-4">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-2">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        <strong>Pr�dictions IA</strong> - Analyse pr�dictive bas�e sur l'historique des ventes
                    </div>
                    
                    <div class="card border-0 shadow-lg mb-4" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <div class="card-body text-white p-4">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="me-3" style="width: 64px; height: 64px; background: rgba(255,255,255,0.2); border-radius: 16px; display: flex; align-items: center; justify-content: center;">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2">
                                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                                                <polyline points="17 6 23 6 23 12"></polyline>
                                            </svg>
                                        </div>
                                        <div>
                                            <h6 class="mb-1 opacity-75">Pr�vision pour les 7 Prochains Jours</h6>
                                            <h2 class="fw-bold mb-0">${forecast.toLocaleString('fr-FR', {minimumFractionDigits: 2, maximumFractionDigits: 2})} FCFA</h2>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 text-center">
                                    <div style="width: 120px; height: 120px; margin: 0 auto; background: rgba(255,255,255,0.2); border-radius: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center;">
                                        <div style="font-size: 2.5rem;">??</div>
                                        <small class="opacity-75 mt-2">7 Jours</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card border-0 shadow-sm mb-4">
                        <div class="card-header bg-white border-0 py-3">
                            <h6 class="fw-bold mb-0">?? Analyse des Tendances</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-light border-start border-4 border-primary">
                                <p class="mb-0" style="line-height: 1.8;">${trends}</p>
                            </div>
                        </div>
                    </div>
                    
                    ${recommendations.length > 0 ? `
                        <div class="card border-0 shadow-sm mb-4">
                            <div class="card-header bg-white border-0 py-3">
                                <h6 class="fw-bold mb-0">?? Recommandations Strat�giques</h6>
                            </div>
                            <div class="card-body">
                                <div class="list-group list-group-flush">
                                    ${recommendations.map((rec, index) => `
                                        <div class="list-group-item border-0 px-0">
                                            <div class="d-flex align-items-start">
                                                <div class="me-3" style="width: 40px; height: 40px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                                                    <span class="text-white fw-bold">${index + 1}</span>
                                                </div>
                                                <div class="flex-grow-1">
                                                    <p class="mb-0" style="line-height: 1.7;">${rec}</p>
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h6 class="fw-bold mb-0">?? Rapport d'Analyse D�taill�</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-light border-start border-4 border-info">
                                <p class="mb-0" style="line-height: 1.8;">${analysisText}</p>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return '<div class="alert alert-warning">Format non reconnu</div>';
        }
        
        // Render Historical Data
        function renderHistoricalData(data) {
            if (typeof data === 'string') {
                try { data = JSON.parse(data); } 
                catch (e) { return '<div class="alert alert-warning">Format de donn�es non reconnu</div>'; }
            }
            
            if (Array.isArray(data) && data.length > 0) {
                const totalDays = data.length;
                const totalCA = data.reduce((sum, item) => sum + (item.ca || 0), 0);
                const avgCA = totalCA / totalDays;
                const maxCA = Math.max(...data.map(item => item.ca || 0));
                const minCA = Math.min(...data.map(item => item.ca || 0));
                const bestDay = data.find(item => item.ca === maxCA);
                const worstDay = data.find(item => item.ca === minCA);
                
                return `
                    <div class="alert alert-info mb-4">
                        <strong>Donn�es Historiques</strong> - Analyse des performances pass�es
                    </div>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                <div class="card-body text-white text-center">
                                    <div class="mb-2">??</div>
                                    <h3 class="fw-bold mb-0">${totalDays}</h3>
                                    <small class="opacity-75">Jours Analys�s</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                                <div class="card-body text-white text-center">
                                    <div class="mb-2">??</div>
                                    <h3 class="fw-bold mb-0">${totalCA.toLocaleString('fr-FR')}</h3>
                                    <small class="opacity-75">CA Total (FCFA)</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                                <div class="card-body text-white text-center">
                                    <div class="mb-2">??</div>
                                    <h3 class="fw-bold mb-0">${avgCA.toFixed(0).toLocaleString('fr-FR')}</h3>
                                    <small class="opacity-75">CA Moyen/Jour</small>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card border-0 shadow-sm h-100" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                                <div class="card-body text-white text-center">
                                    <div class="mb-2">??</div>
                                    <h3 class="fw-bold mb-0">${((maxCA - minCA) / avgCA * 100).toFixed(0)}%</h3>
                                    <small class="opacity-75">Volatilit�</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row g-3 mb-4">
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3">?? Meilleur Jour</h6>
                                    <p class="mb-1"><strong>Date:</strong> ${new Date(bestDay.date).toLocaleDateString('fr-FR')}</p>
                                    <p class="mb-0"><strong>CA:</strong> <span class="text-success">${maxCA.toLocaleString('fr-FR')} FCFA</span></p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card border-0 shadow-sm">
                                <div class="card-body">
                                    <h6 class="fw-bold mb-3">?? Jour le Plus Faible</h6>
                                    <p class="mb-1"><strong>Date:</strong> ${new Date(worstDay.date).toLocaleDateString('fr-FR')}</p>
                                    <p class="mb-0"><strong>CA:</strong> <span class="text-warning">${minCA.toLocaleString('fr-FR')} FCFA</span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card border-0 shadow-sm">
                        <div class="card-header bg-white border-0 py-3">
                            <h6 class="fw-bold mb-0">?? Historique D�taill�</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Date</th>
                                            <th>CA</th>
                                            <th>Performance</th>
                                            <th>Visualisation</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${data.map(item => {
                                            const percentage = (item.ca / maxCA) * 100;
                                            const perfClass = item.ca >= avgCA ? 'success' : item.ca >= avgCA * 0.5 ? 'warning' : 'danger';
                                            const perfText = item.ca >= avgCA ? 'Au-dessus' : item.ca >= avgCA * 0.5 ? 'Moyen' : 'En-dessous';
                                            
                                            return `
                                                <tr>
                                                    <td>${new Date(item.date).toLocaleDateString('fr-FR', {weekday: 'short', day: 'numeric', month: 'short'})}</td>
                                                    <td><span class="badge bg-primary">${item.ca} FCFA</span></td>
                                                    <td><span class="badge bg-${perfClass}">${perfText}</span></td>
                                                    <td>
                                                        <div class="progress" style="height: 25px;">
                                                            <div class="progress-bar bg-${perfClass}" style="width: ${percentage}%">${percentage.toFixed(0)}%</div>
                                                        </div>
                                                    </td>
                                                </tr>
                                            `;
                                        }).join('')}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
            }
            
            return '<div class="alert alert-warning">Aucune donn�e disponible</div>';
        }
        
        // Run tests
        document.getElementById('testPredictions').innerHTML = renderSalesPredictions(samplePredictions);
        document.getElementById('testHistorical').innerHTML = renderHistoricalData(sampleHistorical);
        document.getElementById('testEmpty').innerHTML = renderHistoricalData([]);
    </script>
</body>
</html>
